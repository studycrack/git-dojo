#!/opt/pwn.college/bash

# Create repository and initialize
bash <<'EOF'
mkdir -p /tmp/repo
cd /tmp/repo
git init

# Set user identity
git config user.name "studycrack"
git config user.email "studycrack@korea.com"

# Create master branch and make initial commit
echo 'def init():' > app.py
echo '    print("Initializing...")' >> app.py
git add app.py
git commit -m "Initial commit on master"

# Create feature branch
git checkout -b feature

# Commit 1: add documentation
echo "# Project README" > README.md
git add README.md
git commit -m "docs: add README"

# Commit 2: add target function run()
echo '' >> app.py
echo 'def run():' >> app.py
echo '    print("Running app...")' >> app.py
git add app.py
git commit -m "feat: add run() function"

# Commit 3: add test script
echo "print('test')" > test.py
git add test.py
git commit -m "test: add temporary test script"

# Save version of run() function for checking
git show HEAD~1:app.py > /tmp/app.py
EOF

# Save the expected file with root permissions
mv /tmp/app.py /expected_app.py
chown root:root /expected_app.py
chmod 400 /expected_app.py

# Switch back to master branch
bash <<'EOF'
cd /tmp/repo
git checkout master
EOF
