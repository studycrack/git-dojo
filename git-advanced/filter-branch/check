#!/opt/pwn.college/bash

# Check if /tmp/repo exists and is a directory
if [ ! -d /tmp/repo ]; then
    echo "[-] Do not delete the /tmp/repo directory!"
    exit 1
fi

cd /tmp/repo

# Check if current directory is a Git repository
if [ ! -d .git ]; then
    echo "[-] Do not delete the .git directory!"
    exit 1
fi

# Check if passwords.txt still exists in Git history
if git log --all -- passwords.txt | grep -q "commit"; then
    echo "[-] passwords.txt still exists in the commit history!"
    exit 1
fi

# Check if passwords.txt still exists in the working directory
if test -f passwords.txt; then
    echo "[-] passwords.txt still exists in the working directory!"
    exit 1
fi

# Check if the repository has at least one commit (avoid empty repo)
if [ -z "$(git log -1)" ]; then
    echo "[-] The repository commit history is empty!"
    exit 1
fi

# All checks passed, display the flag
echo "[+] Sensitive file has been removed from history! Here is your flag:"
cat /flag
