#!/opt/pwn.college/bash

set -e

cd /tmp/repo || {
  echo "[-] 无法进入 /tmp/repo 目录!"
  exit 1
}

if [ ! -d .git ]; then
  echo "[-] 未在 /tmp/repo 中初始化 Git 仓库!"
  exit 1
fi

if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
  echo "[-] 没有提交记录!"
  exit 1
fi

if ! git ls-files --error-unmatch hello.txt >/dev/null 2>&1; then
  echo "[-] 未正确提交 hello.txt!"
  exit 1
fi

echo "[+] 检查通过! 下面是你的 flag:"

# exec-suid를 사용해 root 권한으로 /flag 읽기
/usr/bin/exec-suid -- /bin/cat /flag
