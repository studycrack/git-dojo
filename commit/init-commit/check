#!/opt/pwn.college/bash

set -e

cd /tmp/repo || {
  echo "[-] Failed to enter /tmp/repo directory!"
  exit 1
}

if [ ! -d .git ]; then
  echo "[-] Git repository not initialized in /tmp/repo!"
  exit 1
fi

# Debug: Check current Git status
echo "[*] Git status:"
git status

# Debug: Show current Git commit log (if any)
echo "[*] Git commit log:"
if ! git log --oneline; then
  echo "[-] git log failed. No commits might exist!"
fi

# Debug: Check current user and permissions
echo "[*] Current user: $(whoami)"
echo "[*] .git permissions:"
ls -ld .git
ls -l .git/HEAD

# Debug: Show HEAD contents
echo "[*] HEAD contents:"
cat .git/HEAD || echo "[-] Cannot read .git/HEAD!"

# Verify HEAD exists
if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
  echo "[-] No commits found! Make sure you committed at least once (git commit)"
  exit 1
fi

# Check if hello.txt is properly committed
if ! git ls-files --error-unmatch hello.txt >/dev/null 2>&1; then
  echo "[-] hello.txt not properly committed!"
  exit 1
fi

echo "[+] Check passed! Here is your flag:"

# Use exec-suid to read /flag as root
/usr/bin/exec-suid -- /bin/cat /flag
