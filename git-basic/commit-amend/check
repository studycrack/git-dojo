#!/opt/pwn.college/bash

cd /tmp/repo

# Check if there are exactly 3 commits (to ensure no extra commits were added)
COMMIT_COUNT=$(git rev-list --count HEAD)
if [ "$COMMIT_COUNT" -ne 3 ]; then
    echo "[-] Incorrect number of commits. There should be exactly 3 commits."
    exit 1
fi

# Check if the last commit contains the fix (to verify Line 3 was modified and amended)
if ! git show HEAD | grep -q "Line 3 - fixed typo"; then
    echo "[-] Line 3 was not correctly modified, or the changes were not merged into the last commit."
    exit 1
fi

expected="Line 1
Line 2
Line 3 - fixed typo"
actual=$(cat /tmp/repo/log.txt)

if [[ "$actual" != "$expected" ]]; then
    echo "[-] The content of log.txt is incorrect. Please ensure the commit content is correct."
    exit 1
fi

echo "[+] Commit amended successfully! Here is your flag:"
cat /flag
