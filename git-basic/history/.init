#!/opt/pwn.college/bash
if ! command -v git >/dev/null 2>&1; then
  apt update && apt install -y git
fi

sudo -u hacker bash -c '
# æ”¾åœ¨å¯å†™ç›®å½•ï¼Œé¿å…å·è¦†ç›–
REPO=/tmp/repo
mkdir -p "$REPO"
cd "$REPO"
git init -q

# ä¿è¯ git æœ‰ç”¨æˆ·ä¿¡æ¯
git config user.name  "pwnuser"
git config user.email "pwn@college.edu"

# ---- æ­£ç¡®ç‰ˆæœ¬ ----
echo "The flag is safe" > answer.txt
git add answer.txt
git commit -q -m "Add correct answer"
'
# è®°å½•è¯¥æäº¤ï¼Œç”¨äºæ ¡éªŒ
CORRECT_COMMIT=$(git rev-parse HEAD)
echo "$CORRECT_COMMIT" > /expected_commit  

sudo -u hacker bash -c '
# ---- ç ´åç‰ˆæœ¬ ----
echo "Oops, overwritten!" > answer.txt
git add answer.txt
git commit -q -m "Accidentally overwrite answer"

# ç»“æŸåæ‰“å°é¢˜ç›®æç¤º
cat <<'EOF'
ğŸ“œ é¢˜ç›®ç¯å¢ƒå·²ç”Ÿæˆï¼
ç°åœ¨ä»“åº“çš„æœ€æ–° commit æŠŠ answer.txt æåäº†ï¼Œ
è¯·ç”¨ git log / git diff æ‰¾åˆ°â€œAdd correct answerâ€é‚£ä¸€ç‰ˆï¼Œ
å¹¶è®© **å½“å‰ HEAD æŒ‡å‘é‚£æ¬¡æäº¤**ï¼ˆå¯ checkout æˆ– resetï¼‰ã€‚
å®Œæˆååœ¨ä»“åº“ç›®å½•æ‰§è¡Œï¼š   /challenge/check
EOF
'

