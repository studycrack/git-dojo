#!/opt/pwn.college/bash

# Check if /tmp/repo exists and is a directory
if [ ! -d /tmp/repo ]; then
    echo "[-] Do not delete the /tmp/repo folder!"
    exit 1
fi

cd /tmp/repo

# Check if .git directory exists
if [ ! -d .git ]; then
    echo "[-] Do not delete the .git folder!"
    exit 1
fi

# Check if app.py exists in the working directory
if [ ! -f app.py ]; then
    echo "[-] app.py is missing from the working directory! You need to restore it from the staging area and commit it."
    exit 1
fi

# Check if the content of app.py matches the expected version
if ! diff -q app.py /expected_app.py >/dev/null; then
    echo "[-] The contents of app.py are incorrect. You can't fake it! You must restore the original version from the staging area."
    exit 1
fi

# Check if app.py has been successfully committed
if ! sudo -u hacker git log --pretty=format: --name-only | grep -q "^app.py$"; then
    echo "[-] app.py was not successfully committed!"
    exit 1
fi

echo "[+] Well done! You successfully restored and committed the file! Here is your flag:"
cat /flag
