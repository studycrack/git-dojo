#!/opt/pwn.college/bash
set -e

expected=$(cat /challenge/flag_commit)
current=$(git rev-parse HEAD)

# 允许 HEAD 指向目标提交（或处于该提交之上）
if [[ "$current" == "$expected" ]] || git merge-base --is-ancestor "$expected" HEAD; then
  if [[ -f secret.txt && $(cat secret.txt) == "The flag is safe" ]]; then
    echo "[+] 成功恢复丢失提交！"
    echo -n "你的 flag 是："
    cat /flag
    exit 0
  fi
fi

echo "[-] 还未恢复正确提交，请使用 git reflog 查找并 checkout 或 reset 到正确版本"
exit 1

