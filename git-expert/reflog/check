#!/opt/pwn.college/bash

set -e

expected=$(cat /challenge/flag_commit)
current=$(git rev-parse HEAD)

# Allow HEAD to point to the target commit or be a descendant of it
if [[ "$current" == "$expected" ]] || git merge-base --is-ancestor "$expected" HEAD; then
  if [[ -f secret.txt && $(cat secret.txt) == "The flag is safe" ]]; then
    echo "[+] Successfully restored the lost commit!"
    echo -n "Your flag is: "
    cat /flag
    exit 0
  fi
fi

echo "[-] You have not restored the correct commit yet. Please use git reflog to find and checkout or reset to the correct version."
exit 1
