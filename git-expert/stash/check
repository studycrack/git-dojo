#!/opt/pwn.college/bash

set -euo pipefail
repo=$PWD   

# 1. Must be on the master branch
branch=$(git rev-parse --abbrev-ref HEAD)
if [[ "$branch" != "master" ]]; then
  echo "[-] You are not on the master branch"
  exit 1
fi

# 2. Check if hotfix branch has commits with fixes
if ! git log hotfix --pretty=%s | grep -q "fix"; then
  echo "[-] No fix commits found on hotfix branch (commit messages should include 'fix')"
  exit 1
fi

# 3. Check if master has restored changes to app.py
if ! grep -q "working on feature" app.py; then
  echo "[-] master branch has not restored the original changes"
  exit 1
fi

# 4. Check if notes.txt is restored
if [[ ! -f notes.txt ]]; then
  echo "[-] notes.txt not restored, please use git stash -u to save untracked files"
  exit 1
fi

echo "[+] All tasks completed, your flag is:"
cat /flag
